<!DOCTYPE html>
<html>
  <head>
    <title>Simple knockout Integration</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE; chrome=1">
    <link rel="stylesheet" href="../stylesheets/cssreset-min.css">
    <link rel="stylesheet" href="../stylesheets/jquery-ui-1.8.21.css">
    <link rel="stylesheet" href="../stylesheets/cssfonts-min.css">
    <link rel="stylesheet" href="../stylesheets/jquery.ui.grijq.css">
    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/pygment_trac.css">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style type="text/css">
      html,
      body.yui3-cssfonts,
      .yui3-cssfonts *,
      .yui3-cssfonts select,
      .yui3-cssfonts input,
      .yui3-cssfonts button,
      .yui3-cssfonts textarea {
        font: 200 13px/1.5 Lato,"Helvetica Neue",Helvetica,Arial,sans-serif;
      }
      #switcher a span {
        line-height: normal;
      }
      p {
        margin-top: 1em;
        display: none;
        clear: both;
      }
      header p {
        display: block;
      }
      .center {
        text-align: center;
      }
      #the-code pre {
        height: 300px;
        overflow: auto;
      }
    </style>
    <script src="../javascripts/knockout.js"></script>
    <script src="../javascripts/jquery-1.7.2.min.js"></script>
    <script src="../javascripts/jquery-ui-1.8.21.min.js"></script>
    <script src="../javascripts/jquery.ui.grijq.js"></script>
    <script src="../javascripts/data.js"></script>
    <script>
      (function($) {
        $.fn.kobind = function() {
          return $.trim(this.children().data('bind').split(' ')[1]);
        };
      })(jQuery);
      $(function() {
        $('#the-code').hide();
        $('#see-the-code').toggle(function(e) {
          e.preventDefault();
          $(this).html('Hide the code');
          $('#the-code').show('blind');
        }, function(e) {
          e.preventDefault();
          $(this).html('See the code');
          $('#the-code').hide('blind');
        });
        function mapper(a) {
          var attrs = ['name', 'dur', 'album'];
          for(var i = 0; i < a.length; i += 1) {
            for(var j = 0; j < attrs.length; j += 1) {
              a[i][attrs[j]] = ko.observable(a[i][attrs[j]]);
            }
          }
          return ko.observableArray(a);
        }

        // Create the songs list
        var songs = [
          {name: 'Code Monkey', dur: '3:10', album: 'Thing a Week Three'},
          {name: 'Ikea', dur: '3:05', album: 'Smoking Monkey'},
          {name: 'I Feel Fantastic', dur: '3:06', album: 'Our Bodies, Ourselves, Our Cybernetic Arms'},
          {name: 'Mandelbrot Set', dur: '4:22', album: 'Where Tradition Meets Tomorrow'}
        ];

        // Create the grid and on the
        // edit complete, write the value
        // back to the model. On new row,
        // add a new song to the list and,
        // after a moment, select the last
        // row which is the new item.
        $('#inline-data').grijq({
          height: 300,
          hasDivs: true,
          editcomplete: function(e, data) {
            var prop = data.cell.kobind();
            var index = data.cell.parent().prevAll().length;
            viewmodel.songs()[index][prop](data.val);
          },
          newrow: function() {
            viewmodel.songs.push({
              name: ko.observable(' '),
              dur: ko.observable(' '),
              album: ko.observable(' ')
            });
            setTimeout(function() {
              $('#inline-data').grijq('selectLastRow');
            }, 0);
          }
        });

        var viewmodel = {songs: mapper(songs)};
        ko.applyBindings(viewmodel);
      });
    </script>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>grijq</h1>
        <h2>Simple knockout.js integration</h2>
        <nav><div><a href="../">back to the main page</a></div></nav>
        <div>
          <p><a id="see-the-code" href="#">See the code</a></p>
<div id="the-code" class="highlight"><pre><span class="c1">// Create the songs list</span>
<span class="kd">var</span> <span class="nx">songs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Code Monkey&#39;</span><span class="p">,</span> <span class="nx">dur</span><span class="o">:</span> <span class="s1">&#39;3:10&#39;</span><span class="p">,</span> <span class="nx">album</span><span class="o">:</span> <span class="s1">&#39;Thing a Week Three&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ikea&#39;</span><span class="p">,</span> <span class="nx">dur</span><span class="o">:</span> <span class="s1">&#39;3:05&#39;</span><span class="p">,</span> <span class="nx">album</span><span class="o">:</span> <span class="s1">&#39;Smoking Monkey&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;I Feel Fantastic&#39;</span><span class="p">,</span> <span class="nx">dur</span><span class="o">:</span> <span class="s1">&#39;3:06&#39;</span><span class="p">,</span> <span class="nx">album</span><span class="o">:</span> <span class="s1">&#39;Our Bodies, Ourselves, Our Cybernetic Arms&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Mandelbrot Set&#39;</span><span class="p">,</span> <span class="nx">dur</span><span class="o">:</span> <span class="s1">&#39;4:22&#39;</span><span class="p">,</span> <span class="nx">album</span><span class="o">:</span> <span class="s1">&#39;Where Tradition Meets Tomorrow&#39;</span><span class="p">}</span>
<span class="p">];</span>

<span class="c1">// Create the grid and on the</span>
<span class="c1">// edit complete, write the value</span>
<span class="c1">// back to the model. On new row,</span>
<span class="c1">// add a new song to the list and,</span>
<span class="c1">// after a moment, select the last</span>
<span class="c1">// row which is the new item.</span>
<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#inline-data&#39;</span><span class="p">).</span><span class="nx">grijq</span><span class="p">({</span>
  <span class="nx">height</span><span class="o">:</span> <span class="mi">300</span><span class="p">,</span>
  <span class="nx">hasDivs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">editcomplete</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">prop</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cell</span><span class="p">.</span><span class="nx">kobind</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cell</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">prevAll</span><span class="p">().</span><span class="nx">length</span><span class="p">;</span>
    <span class="nx">viewmodel</span><span class="p">.</span><span class="nx">songs</span><span class="p">()[</span><span class="nx">index</span><span class="p">][</span><span class="nx">prop</span><span class="p">](</span><span class="nx">data</span><span class="p">.</span><span class="nx">val</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">newrow</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">viewmodel</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">name</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span>
      <span class="nx">dur</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span>
      <span class="nx">album</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="p">});</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#inline-data&#39;</span><span class="p">).</span><span class="nx">grijq</span><span class="p">(</span><span class="s1">&#39;selectLastRow&#39;</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
        </div>
        <p>
          I sure do like Jonathan Coulton. It'd be nice to maintain a little
          list of his songs. Oh, look! There's one, now! Seems the list of
          songs gets kept in a nice JavaScript array and
          <a href="http://www.knockoutjs.com">knockout.js</a> uses that to
          draw the actual HTML that the <strong>grijq</strong> uses for
          interactivity.
        </p>
      </header>
      <section class="yui3-cssreset yui3-cssfonts">
        <table width="600" id="inline-data" style="width: 599px">
          <colgroup>
            <col width="125">
            <col width="75">
            <col width="400">
          </colgroup>
          <thead>
            <tr>
              <th>Song</th>
              <th>Length</th>
              <th>Album</th>
            </tr>
          </thead>
          <tbody data-bind="foreach: songs">
            <tr>
              <td><div data-bind="text: name"></div></td>
              <td><div data-bind="text: dur"></div></td>
              <td><div data-bind="text: album"></div></td>
            </tr>
          </tbody>
        </table>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/realistschuckle">realistschuckle</a></p>
        <p><small>Powered by <a href="https://github.com/mojombo/jekyll">jekyll</a>. Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="../javascripts/scale.fix.js"></script>
  </body>
</html>
